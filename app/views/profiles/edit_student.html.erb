<% #  This file is app/views/profiles/students.html.haml %>
<h1> Edit Profile </h1>
<%= link_to('Back to profile', single_student_profile_path(@student)) -%>
<%= javascript_tag "var all_schools = #{ @all_schools.to_json };" %>
<%= javascript_tag "var all_majors = #{ @all_majors.to_json };" %>
<%= javascript_tag "var all_skills = #{ @all_skills.to_json };" %>
<%= javascript_tag "var student_skills = #{ @student_skills.to_json };" %>

<script>
  $(function() {
    for (var i = 0; i < all_schools.length; i++){
      all_schools[i].label = all_schools[i].school_name
    }
    for (var i = 0; i < all_majors.length; i++){
      all_majors[i].label = all_majors[i].name
    }
    for (var i = 0; i < all_skills.length; i++){
      all_skills[i].label = all_skills[i].name
    }
    for (var i = 0; i < student_skills.length; i++){
      student_skills[i].label = student_skills[i].name
    }
    $("#college_name").autocomplete({
      minLength: 3,
      source: all_schools,
      select: function(event, ui) {
        $("#college_id").val(ui.item.id)
      }
    });
    $("#major_name").autocomplete({
      minLength: 3,
      source: all_majors,
      select: function(event, ui) {
        $("#major_id").val(ui.item.id)
      }
    });
    $("#graduation_date").datepicker({
      dateFormat: "yy-mm-dd"
    });
    $("#skill_add").autocomplete({
      minLength: 3,
      source: all_skills,
      select: function(event, ui) {
        $("#skill_id").val(ui.item.id)
      }
    });
    $("#skill_remove").autocomplete({
      minLength: 3,
      source: student_skills,
      select: function(event, ui) {
        $("#skill_id_remove").val(ui.item.id)
      }
    });
  });
</script>
<%= form_tag(:action => 'update_student', :id => @student.id) do %>
  <div>
    <label>First Name</label>
    <%= text_field_tag :first_name, params[:first_name], class: 'form-control', value: @student.first_name %>
  </div>
  <div>
    <label>Last Name</label>
    <%= text_field_tag :last_name, params[:last_name], class: 'form-control', value: @student.last_name ? @student.last_name : nil %>
  </div>
  <div>
    <label>Skills</label></br>
    <% @student.skills.all.each do |s| %>
    <li><%=s.name %></li>
    <% end %>
  </div>
  <div>
    <label>Add Skills</label>
    <input type="text" name = "add_skill_name" id="skill_add" class='form-control' ></input>
    <%= hidden_field_tag :skill_id, params[:skill_id], id: "skill_id", value: -1 %>
  </div>
  <div>
    <label>Remove Skills</label>
    <input type="text" name = "remove_skill_name" id="skill_remove" class='form-control' ></input>
    <%= hidden_field_tag :skill_id_remove, params[:skill_id_remove], id: "skill_id_remove", value: -1 %>
  </div>
  <div>
  <div>
    <label>University</label>
    <input type="text" id="college_name" class='form-control' value="<%= @student.college ? @student.college.school_name : nil %>" ></input>
    <%= hidden_field_tag :college_id, params[:college_id], id: "college_id", value: @student.college_id %>
  </div>
  <div>
    <label>Major</label>
    <input type="text" id="major_name" class='form-control' value="<%= @student.major ? @student.major.name : nil %>" ></input>
    <%= hidden_field_tag :major_id, params[:major_id], id: "major_id", value: @student.major_id %>
  </div>
  <div>
    <label>Graduation Date</label>
    <%= text_field_tag :graduation_date, params[:graduation_date], class: 'form-control', id: "graduation_date", value: @student.graduation_date %>
  </div>
  <div>
    <label>Resume Link</label>
    <%= text_field_tag :resume_link, params[:resume_link], class: 'form-control', value: @student.resume_link %>
  </div>
  <div class="actions">
    <%= submit_tag "Submit", class: "btn" %>
  </div>
<% end %>